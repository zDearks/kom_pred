<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Формула выгоды · ЭкоНива</title>

<!-- PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>

<style>
:root{
  --green:#009639; --green2:#0ea76a;
  --ink:#1f2937; --muted:#6b7280;
  --bg:#f6faf7; --card:#fff; --line:#e5e7eb;
  --edit:#fff6bf; --success:#0b6e2b;
  --radius:12px; --rsm:10px;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.header{background:linear-gradient(90deg,var(--green),var(--green2));color:#fff;padding:14px 16px;display:flex;justify-content:space-between;align-items:center;gap:10px}
.header h1{margin:0;font-size:20px}
.header .actions{display:flex;gap:8px}
.btn{border:1px solid #cbd5e1;background:#fff;border-radius:var(--rsm);padding:8px 12px;cursor:pointer}
.btn-primary{background:var(--green);border-color:var(--green);color:#fff}
.container{max-width:1200px;margin:18px auto;padding:0 16px}
.block{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,.04);margin-bottom:16px;overflow:hidden}
.block .head{padding:12px 14px;border-bottom:1px solid var(--line);font-weight:800}
.block .body{padding:14px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--line);padding:12px 14px;vertical-align:middle}
.table th{background:#f3f6f3}
.th-center{text-align:center}
.td-center{text-align:center}
.td-right{text-align:right}
.row-title{font-weight:800;background:#eef8f0}
.cell{width:100%;max-width:140px;padding:8px 10px;border:1px solid #cbd5e1;border-radius:10px;background:var(--edit);font:inherit;text-align:right}
.cell:focus{outline:none;border-color:var(--green);box-shadow:0 0 0 3px rgba(0,150,57,.2)}
.kpi-number{font-size:28px;font-weight:800;color:#c1121f}
.kpi-sub{font-size:22px;font-weight:800;color:#0b6e2b}
.footer{max-width:1200px;margin:18px auto 26px;padding:0 16px;display:flex;justify-content:space-between;align-items:flex-end;gap:14px}
.footer .contacts{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px 14px}
.footer .contacts a{color:#0b6e2b;text-decoration:none}
.footer img{height:86px;width:auto}
@media (max-width:980px){
  .footer{flex-direction:column-reverse;align-items:flex-start}
  .footer img{height:72px}
}
.muted{color:var(--muted)}
</style>
</head>
<body>

<header class="header">
  <h1>Формула выгоды</h1>
  <div class="actions">
    <button id="btnPdf" class="btn btn-primary">Скачать PDF</button>
    <button id="btnReset" class="btn">Сбросить</button>
  </div>
</header>

<main id="capture" class="container">

  <!-- Короткая инструкция (без упоминания «наименование фиксировано») -->
  <section class="block">
    <div class="head">Короткая инструкция</div>
    <div class="body muted">
      Введите показатели для двух коров (жир/белок), базовую цену 1 л молока при базисе <b>3.7/3.2</b> и поголовье. 
      Итоги ниже посчитают стоимость надоев на 10 000 кг, разницу и экономию на всё поголовье. 
      Можно вводить числа с запятой (например, 3,85).
    </div>
  </section>

  <!-- ЕДИНАЯ ТАБЛИЦА ВМЕСТО БЛОКОВ 1 и 2 -->
  <section class="block">
    <div class="head">Параметры и исходные данные</div>
    <div class="body">
      <table class="table">
        <colgroup>
          <col style="width:38%">
          <col style="width:31%">
          <col style="width:31%">
        </colgroup>
        <thead>
          <tr>
            <th class="th-center">Параметр</th>
            <th class="th-center">Корова 1</th>
            <th class="th-center">Корова 2</th>
          </tr>
          <tr>
            <th class="th-center row-title">Показатели</th>
            <th class="th-center">Жир % &nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp; Белок %</th>
            <th class="th-center">Жир % &nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp; Белок %</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-title">Значения</td>
            <td class="td-center">
              <input id="fat1" class="cell" type="number" step="0.01" value="3.85" style="max-width:90px"> &nbsp;&nbsp;|&nbsp;&nbsp;
              <input id="prot1" class="cell" type="number" step="0.01" value="3.45" style="max-width:90px">
            </td>
            <td class="td-center">
              <input id="fat2" class="cell" type="number" step="0.01" value="3.60" style="max-width:90px"> &nbsp;&nbsp;|&nbsp;&nbsp;
              <input id="prot2" class="cell" type="number" step="0.01" value="3.20" style="max-width:90px">
            </td>
          </tr>

          <tr>
            <th class="th-center" colspan="2">Цена 1 л молока при базисе 3.7 / 3.2, ₽</th>
            <th class="th-center">Поголовье, гол.</th>
          </tr>
          <tr>
            <td></td>
            <td class="td-center" colspan="1">
              <input id="basePrice" class="cell" type="number" step="0.01" value="50" style="max-width:120px">
            </td>
            <td class="td-center">
              <input id="heads" class="cell" type="number" step="1" value="1000" style="max-width:120px">
            </td>
          </tr>
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">
        В расчёте используется базис 3.7/3.2 и равные веса влияния жира и белка (50/50).
      </div>
    </div>
  </section>

  <!-- ИТОГИ — как на макете -->
  <section class="block">
    <div class="head">Итоги</div>
    <div class="body">
      <table class="table">
        <colgroup>
          <col style="width:38%">
          <col style="width:20%">
          <col style="width:20%">
          <col style="width:22%">
        </colgroup>
        <thead>
          <tr>
            <th class="th-center"></th>
            <th class="th-center">Корова 1</th>
            <th class="th-center">Корова 2</th>
            <th class="th-center">Разница</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="row-title">Стоимость надоев<br>(на 10&nbsp;000&nbsp;кг), ₽</td>
            <td class="td-right" id="sum1">—</td>
            <td class="td-right" id="sum2">—</td>
            <td class="td-right kpi-number" id="diff">—</td>
          </tr>
          <tr>
            <td class="td-center" colspan="4">
              <span style="font-weight:800">Экономия на всё поголовье:</span>
              &nbsp; <span class="kpi-sub" id="herdDiff">—</span>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">Примечание: объём для расчёта блока выше — 10 000 кг.</div>
    </div>
  </section>

</main>

<!-- Футер -->
<div class="footer">
  <img src="cow.png" alt="ЭкоНива">
  <div class="contacts">
    <div style="font-weight:800;margin-bottom:4px">Контакты для обратной связи</div>
    <div>Алина Сорокина</div>
    <div>Тел.: <a href="tel:+79204085592">+7&nbsp;920&nbsp;408-55-92</a></div>
    <div>E-mail: <a href="mailto:alina.sorokina@ekoniva-apk.com">alina.sorokina@ekoniva-apk.com</a></div>
  </div>
</div>

<script>
/* ===== Настройки ===== */
const VOLUME = 10000;            // фиксированный объём, кг
const BASE_FAT = 3.7;            // базис жир
const BASE_PROT = 3.2;           // базис белок
const W_FAT = 0.5, W_PROT = 0.5; // веса влияния

/* ===== Утилиты ===== */
const el = id => document.getElementById(id);
const num = v => {
  if (v===''||v==null) return 0;
  const n = Number(String(v).replace(',', '.').replace(/\s+/g,''));
  return Number.isFinite(n) ? n : 0;
};
const fmt2 = v => new Intl.NumberFormat('ru-RU',{minimumFractionDigits:2,maximumFractionDigits:2}).format(v);

/* ===== Расчёт ===== */
function calc(){
  const fat1 = num(el('fat1').value),  prot1 = num(el('prot1').value);
  const fat2 = num(el('fat2').value),  prot2 = num(el('prot2').value);
  const basePrice = num(el('basePrice').value);
  const heads = Math.max(1, Math.round(num(el('heads').value)));

  // цена/кг для каждой коровы
  const price1 = basePrice * ( W_FAT*(fat1/BASE_FAT) + W_PROT*(prot1/BASE_PROT) );
  const price2 = basePrice * ( W_FAT*(fat2/BASE_FAT) + W_PROT*(prot2/BASE_PROT) );

  // стоимость надоев на 10 000 кг
  const total1 = price1 * VOLUME;
  const total2 = price2 * VOLUME;
  const diff   = Math.abs(total1 - total2);

  // экономия на всё поголовье
  const herdDiff = diff * heads;

  // вывод
  el('sum1').textContent  = fmt2(total1) + ' ₽';
  el('sum2').textContent  = fmt2(total2) + ' ₽';
  el('diff').textContent  = fmt2(diff)   + ' ₽';
  el('herdDiff').textContent = fmt2(herdDiff) + ' ₽';
}

/* ===== Сброс ===== */
function resetAll(){
  el('fat1').value='3.85'; el('prot1').value='3.45';
  el('fat2').value='3.60'; el('prot2').value='3.20';
  el('basePrice').value='50'; el('heads').value='1000';
  calc();
}

/* ===== PDF ===== */
async function exportPDF(){
  const node = document.getElementById('capture');
  const canvas = await html2canvas(node,{scale:2,useCORS:true});
  const img = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','pt','a4');
  const w = pdf.internal.pageSize.getWidth();
  const h = pdf.internal.pageSize.getHeight();
  const ratio = canvas.width/canvas.height;
  let imgW = w-40, imgH = imgW/ratio, x=20, y=20;
  if (imgH>h-40){ imgH=h-40; imgW=imgH*ratio; }
  pdf.addImage(img,'PNG',x,y,imgW,imgH,'','FAST');
  pdf.save('formula_vygody_ekoniva.pdf');
}

/* ===== Слушатели ===== */
['fat1','prot1','fat2','prot2','basePrice','heads'].forEach(id=>{
  el(id).addEventListener('input', calc);
});
el('btnReset').addEventListener('click', resetAll);
el('btnPdf').addEventListener('click', exportPDF);

/* Старт */
calc();
</script>
</body>
</html>

